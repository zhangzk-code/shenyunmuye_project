<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - 申允木业</title>
    <link rel="stylesheet" href="styles/cms.css">
    <link rel="stylesheet" href="styles/admin.css">
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">网站后台管理系统</div>
            <div class="nav-group">
                <div class="nav-title">数据面板</div>
                <button class="nav-item active" data-tab="contacts">
                    联系记录
                </button>
                <button class="nav-item" data-tab="appointments">
                    预约记录
                </button>
                <button class="nav-item" data-tab="content">
                    内容管理
                </button>
                <button class="nav-item" data-tab="logs">
                    操作日志
                </button>
                <button class="nav-item" data-tab="users">
                    用户管理
                </button>
            </div>
            <div class="nav-group">
                <div class="nav-title">快捷操作</div>
                <button class="nav-item" id="goToWebsiteBtn" title="在新标签页打开官网">🌐 返回官网</button>
                <button class="nav-item" id="goToWebsiteSameTabBtn" title="在当前标签页打开官网">🔗 打开官网</button>
            </div>
        </aside>
        <main class="main">
            <div class="topbar">
                <div style="display: flex; gap: 12px; align-items: center;">
                    <button class="btn-chip" id="helpBtn" type="button" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; box-shadow: 0 2px 4px rgba(14, 165, 233, 0.2);">
                        <span>📖</span> <span>操作说明</span>
                    </button>
                </div>
                <div class="user-info-card">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">admin</div>
                        <div class="user-meta">
                            <span class="user-meta-item" id="userRole">管理员</span>
                            <span class="user-meta-item" id="userIP">IP: 加载中...</span>
                        </div>
                    </div>
                    <button class="logout-btn" id="logoutBtn">退出登录</button>
                </div>
            </div>

            <div id="contactsTab" class="tab-content active">
                <div class="content-card">
                    <div class="section-header">
                        <h2>联系记录</h2>
                        <button class="btn-chip" onclick="loadContacts(true);">刷新数据</button>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-label">总记录数</div>
                            <div class="stat-value" id="contactsTotal">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">待处理</div>
                            <div class="stat-value" id="contactsPending">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">已处理</div>
                            <div class="stat-value" id="contactsProcessed">0</div>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <div id="contactsLoading" class="loading">加载中...</div>
                        <!-- 桌面端表格 -->
                        <table id="contactsTable" class="desktop-table" style="display:none;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>姓名</th>
                                    <th>电话</th>
                                    <th>邮箱</th>
                                    <th>城市</th>
                                    <th>留言内容</th>
                                    <th>提交时间</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="contactsBody"></tbody>
                        </table>
                        <!-- 移动端卡片列表 -->
                        <div id="contactsCards" class="mobile-cards" style="display:none;"></div>
                        <div id="contactsEmpty" class="empty" style="display:none;">暂无数据</div>
                    </div>
                </div>
            </div>

            <div id="appointmentsTab" class="tab-content">
                <div class="content-card">
                    <div class="section-header">
                        <h2>预约记录</h2>
                        <button class="btn-chip" onclick="loadAppointments(true);">刷新数据</button>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-label">总记录数</div>
                            <div class="stat-value" id="appointmentsTotal">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">待联系</div>
                            <div class="stat-value" id="appointmentsPending">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">已确认</div>
                            <div class="stat-value" id="appointmentsConfirmed">0</div>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <div id="appointmentsLoading" class="loading">加载中...</div>
                        <!-- 桌面端表格 -->
                        <table id="appointmentsTable" class="desktop-table" style="display:none;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>姓名</th>
                                    <th>电话</th>
                                    <th>城市</th>
                                    <th>房屋面积</th>
                                    <th>需求描述</th>
                                    <th>提交时间</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="appointmentsBody"></tbody>
                        </table>
                        <!-- 移动端卡片列表 -->
                        <div id="appointmentsCards" class="mobile-cards" style="display:none;"></div>
                        <div id="appointmentsEmpty" class="empty" style="display:none;">暂无数据</div>
                    </div>
                </div>
            </div>

            <div id="contentTab" class="tab-content">
                <!-- CMS顶部工具栏 -->
                <div class="cms-topbar">
                    <div class="cms-topbar-left">
                        <select class="cms-page-selector" id="cmsPageSelector">
                            <option value="global">全站设置</option>
                            <option value="home">首页</option>
                            <option value="products">产品系列</option>
                            <option value="cases">高定案例</option>
                            <option value="service">定制服务</option>
                            <option value="about">关于我们</option>
                            <option value="contact">联系我们</option>
                        </select>
                    </div>
                    <div class="cms-topbar-right">
                        <button class="cms-action-btn cms-action-btn-secondary" id="cmsSaveBtn">
                            💾 保存
                        </button>
                        <button class="cms-action-btn cms-action-btn-secondary" id="cmsPreviewBtn">
                            👁️ 预览
                        </button>
                        <button class="cms-action-btn cms-action-btn-primary" id="cmsPublishBtn">
                            🚀 发布
                        </button>
                    </div>
                </div>

                <div class="content-management-wrapper">
                    <!-- 左侧固定导航 -->
                    <aside class="content-sidebar" id="contentSidebar">
                        <div class="content-sidebar-header">
                            <h3>内容管理</h3>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button class="btn-chip" id="refreshContentBtn" type="button">刷新</button>
                                <button class="btn-chip" id="closeSidebarBtn" type="button" style="display: none;">✕</button>
                            </div>
                        </div>
                        <div class="content-sidebar-nav" id="contentSidebarNav">
                            <!-- 动态生成导航菜单 -->
                        </div>
                    </aside>
                    
                    <!-- 移动端菜单切换按钮（放在侧边栏外部） -->
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">☰</button>
                    
                    <!-- 右侧内容区 -->
                    <main class="content-main-area">
                        <div class="content-main-header">
                            <h2 id="currentPageTitle">站点内容管理</h2>
                            <p class="helper-text" id="currentSectionHint" style="color: #374151; font-size: 13px; margin-top: 4px;">请从左侧选择要编辑的栏目</p>
                        </div>
                        <div id="contentEditor" class="content-editor"></div>
                    </main>
                </div>
            </div>
            
            <!-- 操作说明模态框 -->
            <div id="helpModal" class="modal-overlay" style="display: none; z-index: 10000; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);">
                <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto; background: #ffffff; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 0;">
                    <div class="modal-header" style="position: sticky; top: 0; background: #ffffff; z-index: 10; border-bottom: 2px solid #e5e7eb; padding: 24px; margin-bottom: 0; display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 28px;">📖</span>
                            <span>内容管理系统操作说明书</span>
                        </h2>
                        <button onclick="closeHelpModal()" style="background: #f3f4f6; border: none; font-size: 20px; cursor: pointer; color: #6b7280; padding: 8px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s; font-weight: 600;" onmouseover="this.style.background='#e5e7eb'; this.style.color='#374151';" onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">×</button>
                    </div>
                    <div class="modal-body" id="helpContent" style="padding: 24px; background: #ffffff;">
                        <!-- 内容将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 操作日志标签页 -->
            <div id="logsTab" class="tab-content">
                <div class="content-management-wrapper">
                    <div class="content-main-area" style="width: 100%; padding: 24px;">
                        <div class="content-main-header">
                            <h2>操作日志</h2>
                            <p class="helper-text" style="color: #374151; font-size: 13px; margin-top: 4px;">
                                查看所有内容管理的操作记录，包括保存、发布等操作及其修改内容
                            </p>
                        </div>
                        
                        <!-- 筛选工具栏 -->
                        <div class="logs-toolbar" style="margin-top: 24px; margin-bottom: 20px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                            <select id="logsPageFilter" class="cms-page-selector" style="min-width: 150px;">
                                <option value="">全部页面</option>
                                <option value="global">全站设置</option>
                                <option value="home">首页</option>
                                <option value="products">产品系列</option>
                                <option value="cases">高定案例</option>
                                <option value="service">定制服务</option>
                                <option value="about">关于我们</option>
                                <option value="contact">联系我们</option>
                            </select>
                            <select id="logsTypeFilter" class="cms-page-selector" style="min-width: 120px;">
                                <option value="">全部操作</option>
                                <option value="save">保存草稿</option>
                                <option value="publish">发布</option>
                                <option value="reset">恢复默认</option>
                            </select>
                            <button class="cms-action-btn cms-action-btn-secondary" id="logsRefreshBtn" style="min-width: 80px;">
                                🔄 刷新
                            </button>
                            <button class="cms-action-btn cms-action-btn-secondary" id="logsArchiveBtn" style="min-width: 100px;">
                                📦 归档选中
                            </button>
                            <button class="cms-action-btn cms-action-btn-secondary" id="logsArchivesBtn" style="min-width: 100px;">
                                📚 查看归档
                            </button>
                        </div>
                        
                        <!-- 日志列表 -->
                        <div style="margin-top: 20px; margin-bottom: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #374151; cursor: pointer;">
                                <input type="checkbox" class="log-select-all" style="cursor: pointer;">
                                <span>全选</span>
                            </label>
                        </div>
                        <div id="logsList" class="logs-list" style="margin-top: 12px;">
                            <div class="loading" style="text-align: center; padding: 40px; color: #374151;">
                                加载中...
                            </div>
                        </div>
                        
                        <!-- 归档列表模态框 -->
                        <div id="archivesModal" class="modal-overlay" style="display: none;">
                            <div class="modal" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
                                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border);">
                                    <h3 style="margin: 0; font-size: 20px; font-weight: 600;">归档日志列表</h3>
                                    <button onclick="closeArchivesModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #374151; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='none'">×</button>
                                </div>
                                <div class="modal-body" id="archivesList" style="padding: 0;">
                                    <div class="loading" style="text-align: center; padding: 40px; color: #374151;">
                                        加载中...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 用户管理标签页 -->
            <div id="usersTab" class="tab-content">
                <div class="content-card">
                    <div class="section-header">
                        <h2>用户管理</h2>
                        <button class="btn-chip" id="createUserBtn">➕ 创建用户</button>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-label">总用户数</div>
                            <div class="stat-value" id="usersTotal">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">管理员</div>
                            <div class="stat-value" id="usersAdmin">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">普通用户</div>
                            <div class="stat-value" id="usersNormal">0</div>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <div id="usersLoading" class="loading">加载中...</div>
                        <!-- 桌面端表格 -->
                        <table id="usersTable" class="desktop-table" style="display:none;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>角色</th>
                                    <th>创建时间</th>
                                    <th>最后登录</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="usersBody"></tbody>
                        </table>
                        <!-- 移动端卡片列表 -->
                        <div id="usersCards" class="mobile-cards" style="display:none;"></div>
                        <div id="usersEmpty" class="empty" style="display:none;">暂无用户</div>
                    </div>
                </div>

                <!-- 用户日志区域 -->
                <div class="content-card" style="margin-top: 24px;">
                    <div class="section-header">
                        <h2>用户操作日志</h2>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-chip" id="deleteSelectedUserLogsBtn" style="background: #fee2e2; color: #dc2626;">🗑️ 批量删除</button>
                            <button class="btn-chip" id="refreshUserLogsBtn">🔄 刷新</button>
                        </div>
                    </div>
                    <div style="margin-top: 20px; margin-bottom: 12px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: #374151; cursor: pointer;">
                            <input type="checkbox" class="user-log-select-all" style="cursor: pointer;">
                            <span>全选</span>
                        </label>
                    </div>
                    <div class="table-wrapper">
                        <div id="userLogsLoading" class="loading">加载中...</div>
                        <div id="userLogsList" style="display:none;"></div>
                        <div id="userLogsEmpty" class="empty" style="display:none;">暂无用户日志</div>
                    </div>
                </div>
            </div>

            <!-- 创建/编辑用户模态框 -->
            <div id="userModal" class="modal-overlay" style="display: none;">
                <div class="modal" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3 id="userModalTitle">创建用户</h3>
                        <button onclick="closeUserModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #374151;">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="userForm">
                            <input type="hidden" id="userId" name="userId">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">用户名</label>
                                <input type="text" id="username" name="username" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">密码</label>
                                <input type="password" id="password" name="password" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;">
                                <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">创建用户时必填，修改密码时填写新密码</small>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">角色</label>
                                <select id="newUserRole" name="role" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;">
                                    <option value="admin">管理员</option>
                                    <option value="user">普通用户</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" onclick="closeUserModal()" class="btn-chip" style="background: #f3f4f6; color: #374151;">取消</button>
                                <button type="submit" class="btn-chip" style="background: #4f46e5; color: #fff;">保存</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 修改密码模态框 -->
            <div id="passwordModal" class="modal-overlay" style="display: none;">
                <div class="modal" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>修改密码</h3>
                        <button onclick="closePasswordModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #374151;">×</button>
                    </div>
                    <div class="modal-body">
                        <form id="passwordForm">
                            <input type="hidden" id="passwordUserId" name="userId">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">新密码</label>
                                <input type="password" id="newPassword" name="newPassword" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;">
                            </div>
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" onclick="closePasswordModal()" class="btn-chip" style="background: #f3f4f6; color: #374151;">取消</button>
                                <button type="submit" class="btn-chip" style="background: #4f46e5; color: #fff;">保存</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast 容器 -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- 预览窗口容器 -->
    <div class="preview-container" id="previewContainer"></div>

    <!-- 引入主入口文件 -->
    <script type="module" src="./js/main.js"></script>
</body>
</html>
