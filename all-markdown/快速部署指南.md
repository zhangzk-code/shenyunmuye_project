# 快速部署指南

## Windows 一键启动

### 方式一：使用批处理文件（推荐）

1. **检查依赖**
   ```bash
   检查依赖.bat
   ```

2. **启动所有服务**
   ```bash
   启动所有服务.bat
   ```
   或生产环境：
   ```bash
   启动所有服务.bat prod
   ```

3. **停止所有服务**
   ```bash
   停止所有服务.bat
   ```

### 方式二：手动启动

打开4个命令行窗口，分别执行：

```bash
# 窗口1：前端网站后端
cd shenyunmuye-backend
npm start

# 窗口2：管理后台后端
cd shenyunmuye-admin-backend
npm start

# 窗口3：前端网站
cd shenyunmuye-website
python -m http.server 8080

# 窗口4：管理后台前端
cd shenyunmuye-admin-frontend
python -m http.server 8081
```

## Linux 一键启动

### 1. 上传项目到服务器

```bash
# 使用scp上传（在本地执行）
scp -r shenyunmuye_project user@152.32.209.245:/opt/

# 或使用git clone
git clone <repository_url> /opt/shenyunmuye_project
```

### 2. 安装依赖

```bash
cd /opt/shenyunmuye_project

# 给脚本添加执行权限
chmod +x 启动所有服务.sh
chmod +x 停止所有服务.sh
chmod +x 检查依赖.sh

# 检查并安装依赖
./检查依赖.sh
```

### 3. 配置防火墙

```bash
# Ubuntu/Debian
sudo ufw allow 3000/tcp
sudo ufw allow 3001/tcp
sudo ufw allow 8080/tcp
sudo ufw allow 8081/tcp
sudo ufw reload

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=8081/tcp
sudo firewall-cmd --reload
```

### 4. 启动服务

```bash
# 生产环境启动
./启动所有服务.sh prod

# 或开发环境启动
./启动所有服务.sh
```

### 5. 验证服务

```bash
# 检查服务状态
curl http://localhost:3000/api/health
curl http://localhost:3001/api/admin/health

# 检查端口
netstat -tuln | grep -E '3000|3001|8080|8081'
```

### 6. 停止服务

```bash
./停止所有服务.sh
```

## 访问地址

### 开发环境（localhost）
- 前端网站：http://localhost:8080
- 管理后台：http://localhost:8081/login.html

### 生产环境（152.32.209.245）
- 前端网站：http://152.32.209.245:8080
- 管理后台：http://152.32.209.245:8081/login.html

## 默认账户

- **用户名**：admin
- **密码**：admin123

**重要**：生产环境请立即修改默认密码！

## 使用PM2管理（推荐生产环境）

### 安装PM2

```bash
sudo npm install -g pm2
```

### 创建PM2配置

创建 `ecosystem.config.js`:

```javascript
module.exports = {
  apps: [
    {
      name: 'website-backend',
      script: './shenyunmuye-backend/server.js',
      cwd: __dirname,
      env: {
        NODE_ENV: 'production',
        WEBSITE_BACKEND_PORT: 3000,
        WEBSITE_BACKEND_HOST: '152.32.209.245'
      },
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '1G'
    },
    {
      name: 'admin-backend',
      script: './shenyunmuye-admin-backend/server.js',
      cwd: __dirname,
      env: {
        NODE_ENV: 'production',
        ADMIN_BACKEND_PORT: 3001,
        ADMIN_BACKEND_HOST: '152.32.209.245',
        ADMIN_FRONTEND_URL: 'http://152.32.209.245:8081'
      },
      instances: 1,
      autorestart: true,
      watch: false,
      max_memory_restart: '1G'
    }
  ]
};
```

### 使用PM2

```bash
# 启动
pm2 start ecosystem.config.js

# 查看状态
pm2 status

# 查看日志
pm2 logs

# 停止
pm2 stop all

# 重启
pm2 restart all

# 设置开机自启
pm2 startup
pm2 save
```

## 故障排查

### 端口被占用

```bash
# Linux
lsof -i :端口号
kill -9 PID

# Windows
netstat -ano | findstr :端口号
taskkill /PID PID /F
```

### 依赖问题

```bash
# 重新安装依赖
cd shenyunmuye-backend
rm -rf node_modules
npm install

cd ../shenyunmuye-admin-backend
rm -rf node_modules
npm install
```

### 权限问题

```bash
# Linux: 给脚本添加执行权限
chmod +x *.sh

# 检查文件权限
ls -la *.sh
```

## 安全建议

1. ✅ 修改默认管理员密码
2. ✅ 使用HTTPS（配置SSL证书）
3. ✅ 配置防火墙规则
4. ✅ 使用反向代理（Nginx）
5. ✅ 定期备份数据文件
6. ✅ 配置日志轮转

